name: HTML Quality Check

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to scan"
        required: true

      repo:
        description: "Repositorio"  
        required: true

jobs:
  scan-html:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        repository: mvthivs23/${{ github.event.inputs.repo }}
        ref: ${{ github.event.inputs.branch }}
    - name: Clone the repository to be scanned
      run: |
          git clone --branch ${{ github.event.inputs.branch }} https://github.com/mvthivs23/${{ github.event.inputs.repo }} target_repo
          ls -la target_repo

    - name: Comments validate
      run: |
          echo "Running Comments validate..."

          REPO_DIR="target_repo"

          if [ -d "$REPO_DIR" ]; then
            echo "Scanning HTML files in $REPO_DIR..."
            
            # Define the pattern to search for in comments
            PATTERN="<!--.*-->"

            # Search for comments in HTML files
            MATCHES=$(grep -r -iE "$PATTERN" "$REPO_DIR"/*.html || true)

            if [ -n "$MATCHES" ]; then
              echo "-------------------------------------"
              echo "Comentarios encontrados en los archivos HTML:"
              echo "$MATCHES"
              echo "-------------------------------------"
              exit 1  # Fail the job if comments are found
            else
              echo "-------------------------------------"
              echo "No se encontraron comentarios en los archivos HTML."
              echo "-------------------------------------"
              # Exit with code 0 to indicate success
            fi
            
          else
            echo "Error: Directory $REPO_DIR does not exist."
            exit 1
          fi
  approval-status:
    runs-on: ubuntu-latest
    needs: scan-html
    steps:
      - name: Install figlet
        run: sudo apt-get install figlet

      - name: Display Approval Status
        run: |
          figlet "VB Aprobado"